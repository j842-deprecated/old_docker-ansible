#!/bin/bash

function showusage {
cat <<EOF >&2

NAME
   ansible-getpath - determine the working directory for ansiblession
   
SYNOPSIS
   ansible-getpath MOUNTPATH

DESCRIPTION
   Using the provided MOUNTPATH, determines where within that
   ansiblesession should start based on the PWD on host.
   
RETURN VALUE
   0   - success
   1   - error
   
EOF
   exit 1  
}

if [ $# -ne 1 ]; then 
   showusage
   fi

ANSIBLE_PATH="$1"

if [ ! -d ${ANSIBLE_PATH} ]; then echo "The path ${ANSIBLE_PATH} does not exist!" ; exit 1 ; fi

PWD=$(pwd)

# ensure there is a trailing slash on ANSIBLE_PATH.
prefix="${ANSIBLE_PATH%/}/"

# remove prefix from PWD.
if [ "${PWD}" = "${ANSIBLE_PATH%/}" ]; then
   RELPATH=""
else
   RELPATH="${PWD#$prefix}"
fi

if [ "$RELPATH" = "$PWD" ]; then 
  RELPATH=""
fi

echo "/data/${RELPATH}"
exit 0
