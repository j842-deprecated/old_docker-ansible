#!/bin/bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
. $DIR/bash.conf


function showusage {
cat <<EOF

NAME
   setconfig - set the configuration file for ansible

SYNOPSIS
   setconfig CONFIGFILE

DESCRIPTION
   Update .ansible.cfg with CONFIGFILE.

RETURN VALUE
   0   - success
   1   - error
   3   - no change
   
EOF
   exit 1
}

RVAL=3

if [ -z $1 ]; then
  showusage
fi
if [ ! -e $1 ]; then
  echo "File $1 does not exist."
  exit 1
fi
  
# add the file
rm -rf /tmp/ansible ; mkdir /tmp/ansible ; cp $1 /tmp/ansible

docker run --name ansiblecopy -v ${VOLUME_NAME}:/config -v /tmp/ansible:/tmp/ansible ${CONTAINER_NAME} \
   /bin/bash /usr/local/bin/updateconfig.sh
RVAL=$?

docker rm ansiblecopy > /dev/null
rm -rf /tmp/ansible
  
if [ "$RVAL" = 3 ]; then
   echo "Config file unchanged."
fi

exit $RVAL
